import React from 'react';
import type { ReactElement } from 'react';
import { useCss } from '../../utils/hooks';

import { PaginationWrapper, PageNumber } from './StyledPagination';
import Button from '../Button';
import Icon from '../Icon';
import Typography from '../Typography';
import assert from '../../utils/assert';
import { generatePages, getDisplayState, SPREADING_SYMBOL } from './utils';
import type { CommonProps } from '../common';
import { useTranslation } from '../LocaleProvider/hooks';

export interface PaginationProps extends CommonProps {
  /**
   * Current selected page. This is 1-based indexing.
   */
  current: number;
  /**
   * Change event handler receiving new selected page.
   */
  onChange: (selectedPage: number) => void;
  /**
   * Total number of pages.
   */
  total: number;
  /**
   * Type of pagination.
   */
  variant?: 'basic' | 'compact';
}

const Pagination = ({
  current,
  total,
  onChange,
  variant = 'basic',
  id,
  className,
  style,
  sx = {},
  'data-test-id': dataTestId,
}: PaginationProps): ReactElement => {
  assert(
    current !== 0,
    `[Pagination] 0 for 'current' prop is invalid, you may use 1 instead.`
  );

  const { t } = useTranslation();
  const pages = generatePages({ current, total });

  const basicVariant = (
    <>
      <PageNumber
        type="button"
        themeDisplayAs={current === 1 ? 'disabled' : 'navigator'}
        onClick={(): void => onChange(current - 1)}
      >
        <Icon icon="arrow-left" size="small" />
      </PageNumber>
      {pages.map((pageNumber, index) => {
        const displayAs = getDisplayState({ current, pageNumber });
        return (
          <PageNumber
            key={
              pageNumber !== SPREADING_SYMBOL
                ? pageNumber
                : `${pageNumber}-${index}`
            }
            type="button"
            themeDisplayAs={displayAs}
            onClick={
              pageNumber === SPREADING_SYMBOL
                ? undefined
                : (): void => onChange(pageNumber)
            }
          >
            {pageNumber !== SPREADING_SYMBOL ? (
              pageNumber
            ) : (
              <Icon icon="more-horizontal" size="xsmall" intent="text" />
            )}
          </PageNumber>
        );
      })}
      <PageNumber
        type="button"
        themeDisplayAs={current === total ? 'disabled' : 'navigator'}
        onClick={(): void => onChange(current + 1)}
      >
        <Icon icon="arrow-right" size="small" />
      </PageNumber>
    </>
  );

  const compactVariant = (
    <>
      <Button.Icon
        data-test-id="previous-page"
        icon="single-left-arrow"
        disabled={current === 1}
        intent="primary"
        onClick={(): void => onChange(current - 1)}
        sx={{ mr: 'small' }}
      />
      <Typography.Text fontSize={10}>{`${current} ${t(
        'Of'
      ).toUpperCase()} ${total}`}</Typography.Text>
      <Button.Icon
        data-test-id="next-page"
        icon="single-right-arrow"
        disabled={current === total}
        intent="primary"
        onClick={(): void => onChange(current + 1)}
        sx={{ ml: 'small' }}
      />
    </>
  );

  return (
    <PaginationWrapper
      id={id}
      className={className}
      style={{ ...style, ...useCss(sx) }}
      data-test-id={dataTestId}
    >
      {variant === 'basic' ? basicVariant : compactVariant}
    </PaginationWrapper>
  );
};

export default Pagination;
