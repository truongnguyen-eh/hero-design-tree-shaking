import { useEffect } from 'react';
import type { EffectCallback } from 'react';

export const useScrollLock = (lock: boolean) => {
  useEffect((): ReturnType<EffectCallback> => {
    const isLockAlready = document.body.style.position === 'fixed';

    if (lock && !isLockAlready) {
      const bodyWidth = document.body.offsetWidth;
      const { scrollY } = window;
      Object.assign(document.body.style, {
        position: 'fixed',
        top: `-${scrollY}px`,
        left: 0,
        right: 0,
      });

      const fixedBodyWidth = document.body.offsetWidth;
      Object.assign(document.body.style, {
        right: `${fixedBodyWidth - bodyWidth}px`,
      });

      return () => {
        Object.assign(document.body.style, {
          position: '',
          top: '',
          left: '',
          right: '',
        });
        window.scrollTo(0, scrollY);
      };
    }
  }, [lock]);
};
