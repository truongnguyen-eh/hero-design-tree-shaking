import React, { memo, useMemo } from 'react';
import * as d3 from 'd3';
import { useTheme } from 'styled-components';
import { LineChartXAxisConfig } from '../types';

type XAxisGridProps = {
  width: number;
  height: number;
  xAxisConfig?: LineChartXAxisConfig;
  'data-test-id'?: string;
};
// this component renders the x axis grid
const XAxisGrid = ({
  width,
  height,
  xAxisConfig,
  'data-test-id': dataTestId,
}: XAxisGridProps) => {
  const numberOfLines = xAxisConfig?.labels?.length || 0;
  const xScale = useMemo(() => {
    return d3
      .scaleLinear<number>()
      .domain([0, numberOfLines - 1])
      .range([0, width]);
  }, [width, numberOfLines]);

  const lineChartTheme = useTheme().__hd__.lineChart;
  const xAxisGrid = d3.range(0, numberOfLines).map((value) => {
    return (
      <g key={value} data-test-id="x-axis-grid-line">
        <line
          strokeDasharray={lineChartTheme.strokeDasharray.gridLine}
          x1={xScale(value)}
          y1={0}
          x2={xScale(value)}
          y2={height}
          stroke={lineChartTheme.colors.gridLineBackgroundColor}
          opacity={lineChartTheme.opacity.gridLine}
        />
      </g>
    );
  });

  return <g data-test-id={dataTestId}>{xAxisGrid}</g>;
};

export default memo(XAxisGrid);
