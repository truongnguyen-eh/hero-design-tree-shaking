import React, { useMemo } from 'react';
import Legend from '.';
import Button from '../../Button';
import Tooltip from '../../Tooltip';

import { BaseLegendConfig } from '../type';
import { CommonProps } from '../../common';
import { StyledLegendBox } from './StyledLegend';
import { useTranslation } from '../../LocaleProvider/hooks';

interface LegendCheckboxGroupProps<T> extends BaseLegendConfig, CommonProps {
  getDisplayText: (value: T) => string;
  getColor: (value: T) => string;
  data: T[];
}

const LegendGroup = <T,>(props: LegendCheckboxGroupProps<T>) => {
  const {
    getDisplayText,
    data,
    getColor,
    viewMoreText,
    maxLegend = 4,
    'data-test-id': dataTestId,
    sx,
    className,
    id,
    viewMoreDirection,
  } = props;
  const { t } = useTranslation();
  const slicedData = useMemo(() => data.slice(0, maxLegend), [maxLegend, data]);

  const restData = useMemo(
    () => data.slice(maxLegend, data.length),
    [maxLegend, data]
  );

  const renderCheckboxItem = (item: T) => {
    const displayText = getDisplayText(item);
    return (
      <Legend
        key={displayText}
        checkboxValue={displayText}
        variant="circle"
        title={displayText}
        color={getColor?.(item)}
      />
    );
  };
  return (
    <StyledLegendBox
      data-test-id={dataTestId}
      className={className}
      sx={sx}
      id={id}
    >
      {slicedData.map(renderCheckboxItem)}
      {restData?.length ? (
        <Tooltip
          variant="light"
          target={
            <Button
              text={viewMoreText || t('More')}
              variant="text"
              intent="primary"
              rightIcon="arrow-down"
            />
          }
          content={
            <StyledLegendBox
              data-test-id="legend-view-more-wrapper"
              themeDirection={viewMoreDirection}
            >
              {restData?.map(renderCheckboxItem)}
            </StyledLegendBox>
          }
          interactive
          placement="bottom"
          data-test-id="legend-view-more-text"
        />
      ) : null}
    </StyledLegendBox>
  );
};

export default LegendGroup;
