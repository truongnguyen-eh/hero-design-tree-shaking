import React from 'react';
import userEvent from '@testing-library/user-event';
import renderWithTheme from '../../../testUtils/renderWithTheme';

import Tag from '..';

describe('rendering', () => {
  it('shows tag content', () => {
    const { getByText } = renderWithTheme(<Tag text="Tag text" />);
    expect(getByText('Tag text')).toBeInTheDocument();
  });
});

describe('interaction', () => {
  it('allows to click on it', () => {
    const onRemove = jest.fn();
    const { getByRole } = renderWithTheme(
      <Tag value={1} text="Tag text" onRemove={onRemove} />
    );

    userEvent.click(getByRole('button'));

    expect(onRemove).toHaveBeenCalledTimes(1);
    expect(onRemove).toHaveBeenCalledWith({ text: 'Tag text', value: 1 });
  });
});

describe('with variant/intent', () => {
  it.each`
    variant       | intent
    ${'basic'}    | ${'primary'}
    ${'filled'}   | ${'primary'}
    ${'outlined'} | ${'primary'}
    ${'filled'}   | ${'success'}
    ${'outlined'} | ${'success'}
    ${'filled'}   | ${'danger'}
    ${'outlined'} | ${'danger'}
    ${'filled'}   | ${'warning'}
    ${'outlined'} | ${'warning'}
    ${'filled'}   | ${'error'}
    ${'outlined'} | ${'error'}
    ${'filled'}   | ${'archived'}
    ${'outlined'} | ${'archived'}
  `('renders correctly with $variant & $intent', ({ variant, intent }) => {
    const { container } = renderWithTheme(
      <Tag variant={variant} intent={intent} text="A text" />
    );

    expect(container.firstChild).toMatchSnapshot();
  });

  it.each`
    variant       | intent
    ${'basic'}    | ${'primary'}
    ${'filled'}   | ${'primary'}
    ${'outlined'} | ${'primary'}
    ${'filled'}   | ${'success'}
    ${'outlined'} | ${'success'}
    ${'filled'}   | ${'danger'}
    ${'outlined'} | ${'danger'}
    ${'filled'}   | ${'warning'}
    ${'outlined'} | ${'warning'}
    ${'filled'}   | ${'error'}
    ${'outlined'} | ${'error'}
    ${'filled'}   | ${'archived'}
    ${'outlined'} | ${'archived'}
  `(
    'renders correctly when hovered on close button with $variant & $intent',
    ({ variant, intent }): void => {
      const { getByRole } = renderWithTheme(
        <Tag
          variant={variant}
          intent={intent}
          text="A text"
          onRemove={jest.fn()}
        />
      );

      userEvent.hover(getByRole('button'));

      expect(getByRole('button')).toMatchSnapshot();
    }
  );
});

describe('with size', () => {
  it.each`
    size
    ${'small'}
    ${'medium'}
    ${'large'}
  `('renders correctly with $size', ({ size }) => {
    const { container } = renderWithTheme(<Tag size={size} text="A text" />);
    expect(container.firstChild).toMatchSnapshot();
  });
});

describe('accessibility', () => {
  it('supports ARIA props', () => {
    const { container } = renderWithTheme(
      <Tag text="Tag text" aria-label="Aria label" />
    );

    expect(container.firstChild).toHaveAccessibleName('Aria label');
  });
});
