import React, { Fragment, MouseEvent } from 'react';
import Button from '../Button';
import Dropdown from '../Dropdown';
import Menu from '../Menu';
import Divider from '../Divider';
import { useBoolean } from '../../utils/hooks';
import type { PortletActionMenu } from './types';
import type { IconButtonProps } from '../Button/IconButton';

type PortletActionDropdownProps = IconButtonProps & PortletActionMenu;

const PortletActionDropdown = ({
  menus,
  ...buttonProps
}: PortletActionDropdownProps) => {
  const [open, dropdownActions] = useBoolean(false);

  return (
    <Dropdown
      open={open}
      target={
        <Button.Icon
          {...buttonProps}
          onClick={(e) => {
            dropdownActions.toggle();
            buttonProps.onClick?.(e);
          }}
        />
      }
      onClose={() => {
        dropdownActions.off();
      }}
      content={
        <Menu>
          {menus.map((menu) => {
            const onItemClick = (e: MouseEvent) => {
              menu.item?.onClick?.(e);
              dropdownActions.off();
            };

            return (
              <Fragment key={menu.value}>
                {menu.divider === 'top' && <Divider />}
                <Menu.Item {...menu.item} onClick={onItemClick} />
                {menu.divider === 'bottom' && <Divider />}
              </Fragment>
            );
          })}
        </Menu>
      }
    />
  );
};

export default PortletActionDropdown;
