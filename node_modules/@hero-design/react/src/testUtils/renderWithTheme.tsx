import React from 'react';
import { ThemeProvider } from 'styled-components';
import { render } from '@testing-library/react'; // eslint-disable-line import/no-extraneous-dependencies

import type { ReactElement } from 'react';
import type { RenderOptions } from '@testing-library/react';
import theme from '../theme';
import { fromArray, fromPromiseOfArray } from './UnsafeArray';
import { flow } from '../fp/function';

const renderWithTheme = (ui: ReactElement, options?: RenderOptions) => {
  const renderResult = render(
    <ThemeProvider theme={theme}>{ui}</ThemeProvider>,
    options
  );
  return {
    ...renderResult,
    getAllByText: flow(renderResult.getAllByText, fromArray),
    getAllByDisplayValue: flow(renderResult.getAllByDisplayValue, fromArray),
    findAllByText: flow(renderResult.findAllByText, fromPromiseOfArray),
    rerender: (_ui: Parameters<typeof renderResult.rerender>[0]) =>
      renderResult.rerender(<ThemeProvider theme={theme}>{_ui}</ThemeProvider>),
  };
};

export default renderWithTheme;
