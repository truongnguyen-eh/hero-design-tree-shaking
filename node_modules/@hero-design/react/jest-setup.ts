import '@testing-library/jest-dom';
import { configure } from '@testing-library/react';

configure({
  testIdAttribute: 'data-test-id',
});

// Mock getComputedTextLength function
Object.defineProperty(window.SVGElement.prototype, 'getComputedTextLength', {
  value: jest.fn(function () {
    // Get the text content of the element
    const { textContent } = this;

    return textContent.length;
  }),
});

expect.extend({
  toSelectItem(selectElement, expected) {
    const value = selectElement.querySelector(
      '[data-test-id="selected-item-text"]'
    )?.innerHTML;
    const pass = value === expected;

    if (pass) {
      return {
        message: () => `Expect select element to select item "${expected}"`,
        pass: true,
      };
    }
    return {
      message: () =>
        `Expect select element to select item "${expected}", but receive "${value}"`,
      pass: false,
    };
  },
});

// this is just a little hack to silence a warning that we'll get until we
// upgrade to 16.9. See also: https://github.com/facebook/react/pull/14853
// TODO: remove when upgrade react to 17
const originalError = console.error;
beforeAll(() => {
  console.error = (...args) => {
    if (/Warning.*not wrapped in act/.test(args[0])) {
      return;
    }
    originalError.call(console, ...args);
  };
});

afterAll(() => {
  console.error = originalError;
});
